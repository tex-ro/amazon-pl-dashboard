<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendor Central P&L Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.5.0/dist/Recharts.js"></script>
    <style>
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;
        const { BarChart, Bar, PieChart, Pie, Cell, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } = window.Recharts;

        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwal3bIh65hnWv09vsLv7tH0PCH9h2l8OjCYUJjVbwLK09-qceZjM_m8bzRMEq4VPPdng/exec';

        function VendorDashboard() {
            const [selectedVendor, setSelectedVendor] = useState('etrade');
            const [activeTab, setActiveTab] = useState('overview');
            const [showQuickEntry, setShowQuickEntry] = useState(false);
            const [showUploadModal, setShowUploadModal] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const [sortBy, setSortBy] = useState('margin');
            const [dateRange, setDateRange] = useState({ start: '2025-10-01', end: '2025-10-31' });
            const [syncStatus, setSyncStatus] = useState('idle');
            const [lastSyncTime, setLastSyncTime] = useState(null);
            const [syncedRecords, setSyncedRecords] = useState(new Set());
            const [autoSync, setAutoSync] = useState(false);

            const [asinCostMapping, setAsinCostMapping] = useState({
                'B0FQ2DKLBZ': 950, 'B0DXK2LP5M': 180, 'B0CBN7X3V1': 450, 'B0FLKBTVPM': 85,
                'B0FM454VC4': 1450, 'B0FHHNK55H': 580, 'B0C72QSYTL': 970, 'B0FC687JRP': 75,
            });

            const [expenseData, setExpenseData] = useState({
                advertising: 85000, ccogs: 25000, vret: 15000, freightPerInvoice: 30000
            });

            const [csvData, setCsvData] = useState([
                { 'Order ID': 'TCb7hhcVk', 'Invoice ID': 'GT/437', 'Invoice date': '28 Oct 2025', ASIN: 'B0FQ2DKLBZ', SKU: 'transparent white drawer 4 layer', 'Item Title': 'TEX-RO Plastic Wardrobe', Quantity: '1', 'Item Cost': '₹1,206.99' },
                { 'Order ID': 'TXyGt1YKk', 'Invoice ID': 'GT/437', 'Invoice date': '28 Oct 2025', ASIN: 'B0DXK2LP5M', SKU: 'jolly basket pack of 6', 'Item Title': 'TEX-RO Storage Box', Quantity: '1', 'Item Cost': '₹226.55' },
                { 'Order ID': 'TNYgWhcMk', 'Invoice ID': 'GT/437', 'Invoice date': '28 Oct 2025', ASIN: 'B0CBN7X3V1', SKU: 'dish racks', 'Item Title': 'TEX-RO Utensils Basket', Quantity: '35', 'Item Cost': '₹594.00' }
            ]);

            const vendors = [
                { id: 'etrade', name: 'Etrade' },
                { id: 'retailez', name: 'Retailez' },
                { id: 'clicktech', name: 'Clicktech' }
            ];

            const parseInvoiceData = (data) => {
                const invoices = {};
                const asinMetrics = {};
                
                data.forEach(row => {
                    const asin = row.ASIN;
                    const orderId = row['Order ID'];
                    const invoiceId = row['Invoice ID'];
                    const quantity = parseInt(row.Quantity);
                    const sellingPrice = parseFloat(row['Item Cost'].replace(/[₹,]/g, ''));
                    const cost = asinCostMapping[asin] || 0;
                    
                    if (!invoices[invoiceId]) {
                        invoices[invoiceId] = {
                            invoiceId,
                            date: row['Invoice date'],
                            items: [],
                            totalRevenue: 0,
                            totalCost: 0,
                            synced: syncedRecords.has(`invoice-${invoiceId}`)
                        };
                    }
                    
                    invoices[invoiceId].items.push({
                        orderId, asin, sku: row.SKU, title: row['Item Title'],
                        quantity, sellingPrice, cost,
                        revenue: sellingPrice * quantity,
                        cogs: cost * quantity
                    });
                    
                    invoices[invoiceId].totalRevenue += sellingPrice * quantity;
                    invoices[invoiceId].totalCost += cost * quantity;
                    
                    if (!asinMetrics[asin]) {
                        asinMetrics[asin] = {
                            asin, sku: row.SKU, title: row['Item Title'],
                            cost, units: 0, revenue: 0, cogs: 0,
                            synced: syncedRecords.has(`asin-${asin}`)
                        };
                    }
                    
                    asinMetrics[asin].units += quantity;
                    asinMetrics[asin].revenue += sellingPrice * quantity;
                    asinMetrics[asin].cogs += cost * quantity;
                });
                
                return {
                    invoices: Object.values(invoices),
                    asinMetrics: Object.values(asinMetrics)
                };
            };

            const { invoices, asinMetrics } = useMemo(() => 
                parseInvoiceData(csvData), [csvData, syncedRecords, asinCostMapping]
            );

            const calculateMetrics = (data, type = 'asin') => {
                const totalRevenue = data.reduce((sum, item) => sum + item.revenue, 0);
                
                return data.map(item => {
                    const revenueShare = item.revenue / totalRevenue;
                    const allocatedAd = expenseData.advertising * revenueShare;
                    const allocatedCCOGS = expenseData.ccogs * revenueShare;
                    const allocatedVRET = expenseData.vret * revenueShare;
                    const allocatedFreight = type === 'invoice' 
                        ? expenseData.freightPerInvoice / invoices.length 
                        : expenseData.freightPerInvoice * revenueShare;
                    
                    const grossProfit = item.revenue - item.cogs;
                    const totalExpenses = allocatedAd + allocatedCCOGS + allocatedVRET + allocatedFreight;
                    const netProfit = grossProfit - totalExpenses;
                    const margin = ((netProfit / item.revenue) * 100).toFixed(2);
                    const roi = ((netProfit / item.cogs) * 100).toFixed(2);
                    
                    return {
                        ...item,
                        grossProfit,
                        allocatedAd,
                        allocatedCCOGS,
                        allocatedVRET,
                        allocatedFreight,
                        totalExpenses,
                        netProfit,
                        margin: parseFloat(margin),
                        roi: parseFloat(roi)
                    };
                });
            };

            const asinWithMetrics = useMemo(() => 
                calculateMetrics(asinMetrics, 'asin'), [asinMetrics, expenseData]
            );
            
            const invoiceWithMetrics = useMemo(() => 
                calculateMetrics(invoices.map(inv => ({
                    ...inv,
                    revenue: inv.totalRevenue,
                    cogs: inv.totalCost
                })), 'invoice'), [invoices, expenseData]
            );

            const syncToGoogleSheets = async () => {
                setSyncStatus('syncing');
                try {
                    await fetch(APPS_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            vendor: selectedVendor,
                            dateRange,
                            timestamp: new Date().toISOString(),
                            asinData: asinWithMetrics,
                            invoiceData: invoiceWithMetrics,
                            expenses: expenseData
                        })
                    });

                    const newSyncedRecords = new Set(syncedRecords);
                    asinWithMetrics.forEach(a => newSyncedRecords.add(`asin-${a.asin}`));
                    invoiceWithMetrics.forEach(inv => newSyncedRecords.add(`invoice-${inv.invoiceId}`));
                    setSyncedRecords(newSyncedRecords);
                    
                    setSyncStatus('success');
                    setLastSyncTime(new Date());
                    setTimeout(() => setSyncStatus('idle'), 3000);
                } catch (error) {
                    console.error('Sync error:', error);
                    setSyncStatus('error');
                    setTimeout(() => setSyncStatus('idle'), 3000);
                }
            };

            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const text = e.target.result;
                        const lines = text.split('\n');
                        const headers = lines[0].split(',').map(h => h.trim());
                        
                        const parsedData = lines.slice(1).map(line => {
                            const values = line.split(',');
                            const row = {};
                            headers.forEach((header, index) => {
                                row[header] = values[index]?.trim() || '';
                            });
                            return row;
                        }).filter(row => row['Order ID']);
                        
                        setCsvData(parsedData);
                        setShowUploadModal(false);
                        alert(`Successfully uploaded ${parsedData.length} records!`);
                    };
                    reader.readAsText(file);
                }
            };

            const handleCostUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const text = e.target.result;
                        const lines = text.split('\n');
                        const newMapping = {};
                        
                        lines.slice(1).forEach(line => {
                            const [asin, cost] = line.split(',').map(v => v.trim());
                            if (asin && cost) {
                                newMapping[asin] = parseFloat(cost);
                            }
                        });
                        
                        setAsinCostMapping({...asinCostMapping, ...newMapping});
                        alert(`Successfully uploaded cost mapping for ${Object.keys(newMapping).length} ASINs!`);
                    };
                    reader.readAsText(file);
                }
            };

            const handleExpenseSubmit = (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                setExpenseData({
                    advertising: parseFloat(formData.get('advertising')) || 0,
                    ccogs: parseFloat(formData.get('ccogs')) || 0,
                    vret: parseFloat(formData.get('vret')) || 0,
                    freightPerInvoice: parseFloat(formData.get('freight')) || 0
                });
                setShowQuickEntry(false);
                alert('Expenses updated successfully!');
            };

            useEffect(() => {
                if (autoSync && asinWithMetrics.length > 0) {
                    const timer = setTimeout(() => syncToGoogleSheets(), 2000);
                    return () => clearTimeout(timer);
                }
            }, [asinWithMetrics, invoiceWithMetrics, autoSync]);

            const highMargin = asinWithMetrics.filter(a => a.margin >= 20);
            const mediumMargin = asinWithMetrics.filter(a => a.margin >= 10 && a.margin < 20);
            const lowMargin = asinWithMetrics.filter(a => a.margin < 10);
            const lowROI = asinWithMetrics.filter(a => a.roi < 15);
            const highROI = asinWithMetrics.filter(a => a.roi >= 30);

            const marginDistributionData = [
                { name: 'High Margin (≥20%)', value: highMargin.length, color: '#10b981' },
                { name: 'Medium Margin (10-20%)', value: mediumMargin.length, color: '#f59e0b' },
                { name: 'Low Margin (<10%)', value: lowMargin.length, color: '#ef4444' }
            ];

            const topASINsData = asinWithMetrics
                .sort((a, b) => b.netProfit - a.netProfit)
                .slice(0, 10)
                .map(a => ({ name: a.sku.substring(0, 15), profit: a.netProfit }));

            const exportToCSV = () => {
                const csvContent = [
                    ['ASIN', 'SKU', 'Units', 'Revenue', 'COGS', 'Net Profit', 'Margin %', 'ROI %', 'Synced'].join(','),
                    ...asinWithMetrics.map(a => 
                        [a.asin, a.sku, a.units, a.revenue, a.cogs, a.netProfit, a.margin, a.roi, a.synced ? 'Yes' : 'No'].join(',')
                    )
                ].join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `pnl-report-${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
                    {/* Header */}
                    <div className="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
                        <div className="max-w-7xl mx-auto px-6 py-4">
                            <div className="flex items-center justify-between flex-wrap gap-4">
                                <div className="flex items-center gap-4">
                                    <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                                        <svg className="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h1 className="text-2xl font-bold text-gray-900">Vendor Central Analytics</h1>
                                        <p className="text-sm text-gray-600">Invoice & ASIN-level P&L monitoring</p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-3 flex-wrap">
                                    {syncStatus === 'syncing' && (
                                        <div className="flex items-center gap-2 px-3 py-2 bg-blue-50 text-blue-700 rounded-lg border border-blue-200">
                                            <svg className="w-4 h-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                            </svg>
                                            <span className="text-sm font-medium">Syncing...</span>
                                        </div>
                                    )}
                                    {syncStatus === 'success' && (
                                        <div className="flex items-center gap-2 px-3 py-2 bg-green-50 text-green-700 rounded-lg border border-green-200">
                                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                            <span className="text-sm font-medium">Synced!</span>
                                        </div>
                                    )}
                                    {syncStatus === 'error' && (
                                        <div className="flex items-center gap-2 px-3 py-2 bg-red-50 text-red-700 rounded-lg border border-red-200">
                                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                            </svg>
                                            <span className="text-sm font-medium">Sync Failed</span>
                                        </div>
                                    )}
                                    
                                    {lastSyncTime && (
                                        <div className="text-xs text-gray-500">
                                            Last synced: {lastSyncTime.toLocaleTimeString()}
                                        </div>
                                    )}
                                    
                                    <label className="flex items-center gap-2 px-3 py-2 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition">
                                        <input
                                            type="checkbox"
                                            checked={autoSync}
                                            onChange={(e) => setAutoSync(e.target.checked)}
                                            className="w-4 h-4 text-blue-600 rounded"
                                        />
                                        <span className="text-sm font-medium text-gray-700">Auto-sync</span>
                                    </label>
                                    
                                    <button 
                                        onClick={syncToGoogleSheets}
                                        disabled={syncStatus === 'syncing'}
                                        className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2 font-medium shadow-sm disabled:opacity-50 disabled:cursor-not-allowed"
                                    >
                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
                                        </svg>
                                        Sync to Sheets
                                    </button>
                                    
                                    <button 
                                        onClick={exportToCSV}
                                        className="px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition flex items-center gap-2"
                                    >
                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                        </svg>
                                        Export
                                    </button>

                                    <button 
                                        onClick={() => setShowUploadModal(true)}
                                        className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center gap-2 font-medium shadow-sm"
                                    >
                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                        </svg>
                                        Upload Invoice
                                    </button>

                                    <button 
                                        onClick={() => setShowQuickEntry(true)}
                                        className="px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 transition flex items-center gap-2 font-medium shadow-sm"
                                    >
                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                                        </svg>
                                        Add Expense
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Tab Navigation */}
                        <div className="max-w-7xl mx-auto px-6">
                            <div className="flex gap-4 border-t border-gray-200 overflow-x-auto">
                                {['overview', 'asin-analysis', 'invoice-analysis', 'charts', 'roi-alerts'].map(tab => (
                                    <button
                                        key={tab}
                                        onClick={() => setActiveTab(tab)}
                                        className={`px-4 py-4 font-semibold transition border-b-2 capitalize whitespace-nowrap ${
                                            activeTab === tab
                                                ? 'border-blue-600 text-blue-600'
                                                : 'border-transparent text-gray-600 hover:text-gray-900'
                                        }`}
                                    >
                                        {tab.replace('-', ' ')}
                                        {tab === 'roi-alerts' && lowROI.length > 0 && (
                                            <span className="ml-2 bg-red-500 text-white text-xs px-2 py-0.5 rounded-full">{lowROI.length}</span>
                                        )}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-6 py-8">
                        {/* Date Range Filter */}
                        <div className="bg-white rounded-2xl p-4 shadow-sm mb-6 border border-gray-100">
                            <div className="flex items-center justify-between flex-wrap gap-4">
                                <div className="flex items-center gap-4 flex-wrap">
                                    <div className="flex items-center gap-2">
                                        <svg className="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                        </svg>
                                        <span className="text-sm font-semibold text-gray-700">Date Range:</span>
                                    </div>
                                    <input
                                        type="date"
                                        value={dateRange.start}
                                        onChange={(e) => setDateRange({...dateRange, start: e.target.value})}
                                        className="px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                    <span className="text-gray-500">to</span>
                                    <input
                                        type="date"
                                        value={dateRange.end}
                                        onChange={(e) => setDateRange({...dateRange, end: e.target.value})}
                                        className="px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                    <select 
                                        value={selectedVendor}
                                        onChange={(e) => setSelectedVendor(e.target.value)}
                                        className="px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    >
                                        {vendors.map(v => (
                                            <option key={v.id} value={v.id}>{v.name}</option>
                                        ))}
                                    </select>
                                </div>
                                
                                <div className="flex items-center gap-2 text-sm text-gray-600">
                                    <svg className="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                    </svg>
                                    <span>{syncedRecords.size} records synced</span>
                                </div>
                            </div>
                        </div>

                        {/* Overview Tab Content */}
                        {activeTab === 'overview' && (
                            <div>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                                    <div className="bg-white rounded-2xl p-6 shadow-sm">
                                        <h3 className="text-sm font-medium text-gray-600 mb-2">Total Revenue</h3>
                                        <p className="text-3xl font-bold text-gray-900">
                                            ₹{asinWithMetrics.reduce((s, a) => s + a.revenue, 0).toLocaleString('en-IN')}
                                        </p>
                                        <p className="text-xs text-gray-500 mt-1">From all orders</p>
                                    </div>
                                    <div className="bg-white rounded-2xl p-6 shadow-sm">
                                        <h3 className="text-sm font-medium text-gray-600 mb-2">Net Profit</h3>
                                        <p className="text-3xl font-bold text-gray-900">
                                            ₹{asinWithMetrics.reduce((s, a) => s + a.netProfit, 0).toLocaleString('en-IN')}
                                        </p>
                                        <p className="text-xs text-gray-500 mt-1">
                                            Margin: {((asinWithMetrics.reduce((s, a) => s + a.netProfit, 0) / asinWithMetrics.reduce((s, a) => s + a.revenue, 0)) * 100).toFixed(1)}%
                                        </p>
                                    </div>
                                    <div className="bg-white rounded-2xl p-6 shadow-sm">
                                        <h3 className="text-sm font-medium text-gray-600 mb-2">Active ASINs</h3>
                                        <p className="text-3xl font-bold text-gray-900">{asinWithMetrics.length}</p>
                                        <p className="text-xs text-gray-500 mt-1">{highMargin.length} high margin</p>
                                    </div>
                                    <div className="bg-white rounded-2xl p-6 shadow-sm">
                                        <h3 className="text-sm font-medium text-gray-600 mb-2">Avg ROI</h3>
                                        <p className="text-3xl font-bold text-gray-900">
                                            {(asinWithMetrics.reduce((s, a) => s + a.roi, 0) / asinWithMetrics.length).toFixed(1)}%
                                        </p>
                                        <p className="text-xs text-gray-500 mt-1">Across all ASINs</p>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="bg-gradient-to-br from-green-500 to-green-600 rounded-2xl p-6 text-white shadow-lg">
                                        <h3 className="text-lg font-semibold mb-2">High Margin</h3>
                                        <p className="text-4xl font-bold mb-2">{highMargin.length}</p>
                                        <p className="opacity-90 text-sm">ASINs ≥20% margin</p>
                                    </div>
                                    <div className="bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-2xl p-6 text-white shadow-lg">
                                        <h3 className="text-lg font-semibold mb-2">Medium Margin</h3>
                                        <p className="text-4xl font-bold mb-2">{mediumMargin.length}</p>
                                        <p className="opacity-90 text-sm">ASINs 10-20% margin</p>
                                    </div>
                                    <div className="bg-gradient-to-br from-red-500 to-red-600 rounded-2xl p-6 text-white shadow-lg">
                                        <h3 className="text-lg font-semibold mb-2">Low Margin</h3>
                                        <p className="text-4xl font-bold mb-2">{lowMargin.length}</p>
                                        <p className="opacity-90 text-sm">ASINs <10% margin</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* ASIN Analysis Tab */}
                        {activeTab === 'asin-analysis' && (
                            <div className="bg-white rounded-2xl p-6 shadow-sm">
                                <h2 className="text-xl font-bold mb-4">ASIN Performance Analysis</h2>
                                <p className="text-gray-600">Detailed ASIN-level metrics coming soon...</p>
                            </div>
                        )}

                        {/* Invoice Analysis Tab */}
                        {activeTab === 'invoice-analysis' && (
                            <div className="bg-white rounded-2xl p-6 shadow-sm">
                                <h2 className="text-xl font-bold mb-4">Invoice-Level Profitability</h2>
                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-50 border-b">
                                            <tr>
                                                <th className="py-3 px-4 text-left text-xs font-semibold text-gray-600">Invoice ID</th>
                                                <th className="py-3 px-4 text-left text-xs font-semibold text-gray-600">Date</th>
                                                <th className="py-3 px-4 text-right text-xs font-semibold text-gray-600">Revenue</th>
                                                <th className="py-3 px-4 text-right text-xs font-semibold text-gray-600">Net Profit</th>
                                                <th className="py-3 px-4 text-right text-xs font-semibold text-gray-600">Margin %</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {invoiceWithMetrics.map((inv) => (
                                                <tr key={inv.invoiceId} className="border-b hover:bg-gray-50">
                                                    <td className="py-3 px-4 font-semibold text-blue-600">{inv.invoiceId}</td>
                                                    <td className="py-3 px-4 text-sm">{inv.date}</td>
                                                    <td className="py-3 px-4 text-right">₹{inv.revenue.toLocaleString('en-IN')}</td>
                                                    <td className="py-3 px-4 text-right">₹{inv.netProfit.toLocaleString('en-IN')}</td>
                                                    <td className="py-3 px-4 text-right">
                                                        <span className={`px-2 py-1 rounded-full text-sm font-bold ${
                                                            inv.margin >= 20 ? 'bg-green-100 text-green-700' :
                                                            inv.margin >= 10 ? 'bg-yellow-100 text-yellow-700' :
                                                            'bg-red-100 text-red-700'
                                                        }`}>
                                                            {inv.margin}%
                                                        </span>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {/* Charts Tab */}
                        {activeTab === 'charts' && (
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div className="bg-white rounded-2xl p-6 shadow-sm">
                                    <h3 className="text-lg font-bold mb-4">Margin Distribution</h3>
                                    <ResponsiveContainer width="100%" height={300}>
                                        <PieChart>
                                            <Pie
                                                data={marginDistributionData}
                                                cx="50%"
                                                cy="50%"
                                                labelLine={false}
                                                label={({ name, percent }) => `${name.split(' ')[0]}: ${(percent * 100).toFixed(0)}%`}
                                                outerRadius={100}
                                                dataKey="value"
                                            >
                                                {marginDistributionData.map((entry, index) => (
                                                    <Cell key={`cell-${index}`} fill={entry.color} />
                                                ))}
                                            </Pie>
                                            <Tooltip />
                                        </PieChart>
                                    </ResponsiveContainer>
                                </div>

                                <div className="bg-white rounded-2xl p-6 shadow-sm">
                                    <h3 className="text-lg font-bold mb-4">Top 10 ASINs by Profit</h3>
                                    <ResponsiveContainer width="100%" height={300}>
                                        <BarChart data={topASINsData}>
                                            <CartesianGrid strokeDasharray="3 3" />
                                            <XAxis dataKey="name" angle={-45} textAnchor="end" height={100} />
                                            <YAxis />
                                            <Tooltip formatter={(value) => `₹${value.toLocaleString('en-IN')}`} />
                                            <Bar dataKey="profit" fill="#3b82f6" />
                                        </BarChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                        )}

                        {/* ROI Alerts Tab */}
                        {activeTab === 'roi-alerts' && (
                            <div className="space-y-6">
                                <div className="bg-white rounded-2xl p-6 shadow-sm border-l-4 border-red-500">
                                    <h2 className="text-xl font-bold mb-4 text-red-700">Low ROI Alert</h2>
                                    <p className="text-sm text-gray-600 mb-4">ASINs with ROI below 15% - Review pricing or costs</p>
                                    <div className="text-3xl font-bold">{lowROI.length} ASINs</div>
                                </div>

                                <div className="bg-white rounded-2xl p-6 shadow-sm border-l-4 border-green-500">
                                    <h2 className="text-xl font-bold mb-4 text-green-700">High ROI Performers</h2>
                                    <p className="text-sm text-gray-600 mb-4">ASINs with ROI above 30% - Consider scaling up</p>
                                    <div className="text-3xl font-bold">{highROI.length} ASINs</div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Upload Modal */}
                    {showUploadModal && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-2xl shadow-2xl max-w-2xl w-full p-6">
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className="text-2xl font-bold">Upload Invoice Data</h3>
                                    <button onClick={() => setShowUploadModal(false)} className="p-2 hover:bg-gray-100 rounded-lg">
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                
                                <div className="space-y-4">
                                    <div className="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center">
                                        <input type="file" accept=".csv" className="hidden" id="invoice-upload" onChange={handleFileUpload} />
                                        <label htmlFor="invoice-upload" className="cursor-pointer">
                                            <div className="mb-4">
                                                <svg className="w-12 h-12 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                                </svg>
                                            </div>
                                            <p className="text-lg font-semibold mb-2">Upload Invoice CSV</p>
                                            <p className="text-sm text-gray-600">Click to browse or drag and drop</p>
                                        </label>
                                    </div>

                                    <div className="border-t pt-4">
                                        <h4 className="font-semibold mb-2">Upload ASIN Cost Mapping (Optional)</h4>
                                        <input type="file" accept=".csv" className="hidden" id="cost-upload" onChange={handleCostUpload} />
                                        <label htmlFor="cost-upload" className="inline-block px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 cursor-pointer">
                                            Choose Cost File
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Expense Entry Modal */}
                    {showQuickEntry && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full">
                                <div className="p-6 border-b flex items-center justify-between">
                                    <h3 className="text-2xl font-bold">Add Daily Expenses</h3>
                                    <button onClick={() => setShowQuickEntry(false)} className="p-2 hover:bg-gray-100 rounded-lg">
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                
                                <form onSubmit={handleExpenseSubmit} className="p-6 space-y-4">
                                    <div>
                                        <label className="block text-sm font-semibold mb-2">Date</label>
                                        <input type="date" className="w-full px-4 py-3 border rounded-xl" defaultValue={new Date().toISOString().split('T')[0]} />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-semibold mb-2">Advertising Spend</label>
                                        <input type="number" name="advertising" placeholder="0.00" defaultValue={expenseData.advertising}
                                            className="w-full px-4 py-3 border rounded-xl" />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-semibold mb-2">CCOGS (Product Discounts)</label>
                                        <input type="number" name="ccogs" placeholder="0.00" defaultValue={expenseData.ccogs}
                                            className="w-full px-4 py-3 border rounded-xl" />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-semibold mb-2">VRET (Returns from FC)</label>
                                        <input type="number" name="vret" placeholder="0.00" defaultValue={expenseData.vret}
                                            className="w-full px-4 py-3 border rounded-xl" />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-semibold mb-2">Freight to FC</label>
                                        <input type="number" name="freight" placeholder="0.00" defaultValue={expenseData.freightPerInvoice}
                                            className="w-full px-4 py-3 border rounded-xl" />
                                    </div>

                                    <button type="submit" className="w-full bg-blue-600 text-white py-3 rounded-xl hover:bg-blue-700 font-semibold">
                                        Save Expenses
                                    </button>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<VendorDashboard />, document.getElementById('root'));
    </script>
</body>
</html>
